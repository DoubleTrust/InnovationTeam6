<!doctype html>
<html>
    <head>
        <meta http-equiv="refresh" content="300">
        <meta charset="utf-8">
            <title>page for teachers</title>
        <link href="css/main1.css" rel="stylesheet" />
        <link rel="stylesheet" type="text/css" href="litewebchat.css">
        <script src="js/jquery-3.5.1.min.js"></script>
        <script src="js/dialog.js"></script>

    </head>
    <style>

    </style>
    <body>
        <div id="video">
            <p style="text-align:center">Video</p>

            <!-- for highlight question -->
            <div id="highlighted_questions" style="text-align:right; visibility:hidden">
                <h1>Important questions</h1>
                <h2>What does VPC mean?</h2>
                <div>
                    <button onclick="changeVisibility_with_question()">Answer now</button>
                    <button onclick="changeVisibility_with_export()">Answer later</button>
                </div>          
            </div>

            <!-- for question export -->
            <div id="question_collections" style="text-align:center;margin:0 auto; width:300px; border-style: solid;visibility: hidden;">
                <a id="dlink" style="display:none;"></a>
                <table id="collected" class="table" style="background-color: #ffffff;">
                    <tbody id ="question_list">
                    <tr>
                        <th class="anchorjs-icon">Name</th>
                        <th class="anchorjs-icon">Question</th>
                        <th class="anchorjs-icon">Rating</th>
                    </tr>
                   <tr>
                        <td>Jeff</td>
                        <td>What does BMC mean here?</td>
                        <td>2</td>
                   </tr>
                    </tbody>
                </table>
                <button id="export" onclick=>Download</button>
            </div>
        </div>
            

        <div id="chat" style="font-size: 0"><!--取出两个button之间的间隙-->
                <button style="outline:none;border-radius:5px;border: none;width: 50%;height: 100%" onclick="showDiv();">
                    Particiption</button>
                <button style="outline:none;border-radius:5px;border: none;width: 50%;height: 100%" onclick="showDiv();">
                    Chat</button>

        </div>
        <div id="div1" class="col-md-7 agileits_mail_grid_left" style="display: block;border-radius:10px">
            <div class="lite-chatbox" id="words">
                <!-- cleft  -->
                <div class="cleft cmsg">
                    <span class="name">chenjunyu19</span>
                    <span id = "example_question" class="content">What does the VPC mean?</span>
                    <span id="example_rate1" class="content">+4</span>
                </div>

                <div class="cleft cmsg">
                    <span class="name">SuperPaxxs</span>
                    <span class="content">What does BMC mean here?</span>
                    <span id = "example_rate2" class="content" >+2</span>  
                </div>
            </div>
        </div>

        <div id="div2" class="col-md-7 agileits_mail_grid_left" style="display: none;border-radius:10px">
                    <table class="table" style="background-color: #ffffff">
                        <tbody>

                        <dl>
                            <dt>
                                <div id="teacher1">
                                    <h3> Prof. Chimin  <h4 id="changepercentage"> answerd 90% questions </h4> </h3>
                                </div>
                            </dt>
                            <hr/>
                            <dt>
                                <div id="user1">
                                    <img src="img/l1.png" style="width:5%;height:5%;vertical-align: middle" >
                                    <h3>Tome</h3>
                                </div>
                            </dt>
                            <hr/>
                            <dt>
                                <div id="user2">
                                    <img src="img/l3.png" style="width:5%;height:5%;vertical-align: middle" >
                                    <h3>Jim</h3>
                                </div>
                            </dt>
                            <hr/>
                            <dt>
                                <div id="user3">
                                    <img src="img/l5.png" style="width:5%;height:5%;vertical-align: middle" >
                                    <h3>Perre</h3>
                                </div>
                            </dt>
                            <hr/>
                            <dt>
                                <div id="user4">
                                    <img src="img/l7.png" style="width:5%;height:5%;vertical-align: middle" >
                                    <h3>Ham</h3>
                                </div>
                            </dt>
                            <hr/>
                        </dl>


                        </tbody>
                    </table>
        </div>

        <div id="tools">



            <button id="voice" >Voice</button>
            <button id="uservidero">Video</button>
            <button id="rank">questions</button>
            <button id="collected_questions" onclick=change_collected_question_visibility()>Collected questions</button>

        <!-- 引入jquery.js -->
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>


        <script>
            function change_collected_question_visibility()
            {
                document.getElementById("question_collections").style.visibility="visible";
            }
            function changeVisibility_with_export() // for highlighted students
            {
                document.getElementById("highlighted_questions").style.visibility="hidden";

                // Add to question list
                question_str = '<tr><td>chenjunyu19</td><td>'+ document.getElementById("example_question").innerHTML + '</td><td>5</td></tr>'
                var question_list = document.getElementById("question_list");
                question_list.innerHTML = question_list.innerHTML + question_str;
            }
            function changeVisibility_with_question()
            {
                document.getElementById("highlighted_questions").style.visibility="hidden";
                document.getElementById("example_question").style.background="#72D6A0";
            }
            
            // Monitor highlight from students change
            window.addEventListener("storage",function(e){
                var test =localStorage.getItem("question");
                if (test != null){
                    document.getElementById("highlighted_questions").style.visibility = "visible";
                    document.getElementById("example_rate1").innerHTML = "+5";
                }

            });

            // Monitor chatbox change
            window.addEventListener("storage",function(e){
                // save to local storage
                var value = localStorage.getItem("Alan"); // if not working, change the key or clear
                
                if (value != null){
                    str = '<div class="cleft cmsg"><span class="name">' + 'Alan' + '</span><span class="content">'+ value + '</span><span id="example_rate" class="content">+1</span></div>'
                    var Words = document.getElementById("words");
                    Words.innerHTML = Words.innerHTML + str;
                    
                    if (value.indexOf("?") != -1){
                        // Add to question list
                        question_str = '<tr><td>Alan</td><td>'+ value + '</td><td>1</td></tr>'
                        var question_list = document.getElementById("question_list");
                        question_list.innerHTML = question_list.innerHTML + question_str;
                    }
                } 

                var p3 = localStorage.getItem("p3"); // if not working, change the key or clear
                if (p3 != null){
                    document.getElementById("example_rate2").innerHTML = p3;
                } 

                localStorage.clear();
            });
                            

            // Chat-box code (input)
            window.onload = function(){
                var Words = document.getElementById("words");
                var Who = "You (Green) ";
                var TalkWords = document.getElementById("talkwords");
                var TalkSub = document.getElementById("talksub");
                
                
                TalkSub.onclick = function(){
                    //定义空字符串
                    var str = "";
                    if(TalkWords.value == ""){
                         // 消息为空时弹窗
                        alert("消息不能为空");
                        return;
                    }
                    str = '<div class="cleft cmsg"><span class="name">' + Who + '</span><span class="content">'+ TalkWords.value + '</span><span id="example_rate" class="content">+1</span></div>'

                    Words.innerHTML = Words.innerHTML + str;
                    document.getElementById("talkwords").value="";

                }
            }
            
            var id = "collected",
                worksheetName = 'sheet',
                workName = "Question collections.xls";
            

            // Export remaining questions
            document.getElementById('export').onclick = function() {
                var download = tableToExcel();
                download(id, worksheetName, workName);
                document.getElementById("question_collections").style.visibility = "hidden";
            };

            // Export main function
            var tableToExcel = (function() {
                var uri = 'data:application/vnd.ms-excel;base64,',
                    template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',
                    base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) },
                    format = function(s, c) { return s.replace(/{(\w+)}/g, function(m, p) { return c[p]; }) };
                return function(table, name, filename) {
                    if (!table.nodeType) table = document.getElementById(table);
                    console.log(table.innerHTML)
                    var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML }//此时的innerHTML数据可以自己自定义 比如json转化 只要值要数据符合即可
        
                    document.getElementById("dlink").href = uri + base64(format(template, ctx));
                    document.getElementById("dlink").download = filename;
                    document.getElementById("dlink").click();
                }

            });

            function showDiv() {
                var div1=document.getElementById("div1");
                var div2=document.getElementById("div2");

                if (div1.style.display==='block')
                    div1.style.display='none';
                else div1.style.display='block';
                if (div2.style.display==='block')
                    div2.style.display='none';
                else div2.style.display='block';
            }
            function openwin() {
                window.open ("rankpage.html", "height=100, width=400, toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")
}

        </script>
        </div>
        <div id="input">
            <input type="text" style="width:300px;height:16px;padding:0px;float:left;text-indent:5px;" id="talkwords">
            <input type="button" value="send" style="float:left;margin-left:10px;" id="talksub">    
        </div>

        <div id="background" class="back">
                <div id="poptop" class="content">
                    <div id="close">
                        <span id="close-button">×</span>
                        <h2>Post questions list</h2>
                    </div>
                    <div id="poptitile">
<!--                        <h3>弹窗标题</h3>-->
                        <table width="100%" border="1" >
                              <thead>
                                  <tr>
                                    <th class="main" scope="col" rowspan="2">Question Content</th>
                                    <th class="main" scope="col" colspan="6">Information </th>
                                  </tr>
                                  <tr class="sub-main" >
                                    <th>Credits</th>
                                    <th>Post</th>
                                  </tr>
                              </thead>
                              <tbody>
                              <tr>
                                <th scope="row" class="sub-main">Where is your house?</th>
                                <td>5 credits</td>
                                <td id="changecredits">
                                    <input  class="post" type="submit" value="POST" onclick="finish()" disabled="disabled"/>
                                </td>
                              </tr>
                              <tr>
                                <th name="pp" scope="row" class="sub-main">What is Flask?</th>
                                <td>10 credits</td>
                                <td>
                                    <input id="post1" class="post" type="button" value="POST" onclick="finish()"/>
                                </td>

                              </tr>

                              </tbody>

                            </table>

                    </div>
                    <h3 id="foot">Good Job</h3>
                </div>
            </div>
        <script>
            function finish(){
                var button1 = document.getElementById('post1')
                button1.disabled = true;
                console.log(button1);
            }
        </script>
        <script src="js/tc_teacher.js"></script>
    </body>

</html>